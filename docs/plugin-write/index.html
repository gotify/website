<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Writing Plugins · Gotify</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Description"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Writing Plugins · Gotify"/><meta property="og:type" content="website"/><meta property="og:url" content="https://gotify.net/"/><meta property="og:description" content="## Description"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><h2 class="headerTitle">Gotify</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/" target="_self">Docs</a></li><li class=""><a href="/api-docs" target="_self">API-Docs</a></li><li class=""><a href="https://github.com/gotify" target="_self">SourceCode</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Plugins</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/">Intro</a></li><li class="navListItem"><a class="navItem" href="/docs/install">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/config">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/first-login">First Login</a></li><li class="navListItem"><a class="navItem" href="/docs/pushmsg">Push messages</a></li><li class="navListItem"><a class="navItem" href="/docs/msgextras">Message Extras</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">REST-API</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/swagger-docs">Swagger Documentation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Plugins</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/plugin">Intro to Gotify Plugins</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/plugin-write">Writing Plugins</a></li><li class="navListItem"><a class="navItem" href="/docs/plugin-deploy">Building and Deploying Plugins</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Development</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/dev-setup">Setup Environment</a></li><li class="navListItem"><a class="navItem" href="/docs/dev-server-and-tests">Servers and Tests</a></li><li class="navListItem"><a class="navItem" href="/docs/build">Build Gotify</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Miscellaneous</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/apache">Apache reverse proxy</a></li><li class="navListItem"><a class="navItem" href="/docs/caddy">Caddy 2 reverse proxy</a></li><li class="navListItem"><a class="navItem" href="/docs/haproxy">Haproxy reverse proxy</a></li><li class="navListItem"><a class="navItem" href="/docs/more-pushmsg">(more) Push message examples</a></li><li class="navListItem"><a class="navItem" href="/docs/nginx">nginx reverse proxy</a></li><li class="navListItem"><a class="navItem" href="/docs/optimize-images">Optimize uploaded images</a></li><li class="navListItem"><a class="navItem" href="/docs/systemd">systemd configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/traefik">Traefik reverse proxy</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/gotify/website/edit/master/docs/plugin-write.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Writing Plugins</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="description"></a><a href="#description" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Description</h2>
<p>Lets take a closer look at the minimal plugin instance we created in the <a href="/docs/plugin">intro</a> part:</p>
<pre><code class="hljs css language-golang"><span class="hljs-comment">// Plugin is plugin instance</span>
<span class="hljs-keyword">type</span> Plugin <span class="hljs-keyword">struct</span>{}

<span class="hljs-comment">// Enable implements plugin.Plugin</span>
<span class="hljs-comment">// Invoked just after initialization if plugin is already enabled.</span>
<span class="hljs-comment">// Invoked every time the plugin is switched to enabled.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Plugin)</span> <span class="hljs-title">Enable</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// Disable implements plugin.Plugin</span>
<span class="hljs-comment">// Invoked every time the plugin is switched to disabled.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Plugin)</span> <span class="hljs-title">Disable</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<p>Now only the base <a href="https://godoc.org/github.com/gotify/plugin-api#Plugin"><code>Plugin</code></a> interface has been implemented.
To give it more functionalities, more interfaces can be implemented.</p>
<h2><a class="anchor" aria-hidden="true" id="apis"></a><a href="#apis" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>APIs</h2>
<h3><a class="anchor" aria-hidden="true" id="intro"></a><a href="#intro" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Intro</h3>
<p>The APIs are provided as interfaces will be called during plugin initialization and/or remote API invocation to obtain information or provide callbacks.</p>
<h3><a class="anchor" aria-hidden="true" id="api-interfaces"></a><a href="#api-interfaces" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API Interfaces</h3>
<p><em>These are all API interfaces exposed by gotify. Some interface implementations are omitted in the examples.</em></p>
<h4><a class="anchor" aria-hidden="true" id="displayer"></a><a href="#displayer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Displayer</h4>
<p><a href="https://godoc.org/github.com/gotify/plugin-api#Displayer"><code>Displayer</code></a> is the most simple form of plugin API, it is used to provide instructions on the plugin page in the WebUI.
Plugins can dynamically generate information based on the current state.
It receives a <code>location</code> parameter contains the server's hostname, port and scheme recovered from the original request to the <code>Displayer</code> API.
Markdown is supported.</p>
<p>The REST API for this exposed at <a href="/api-docs#/plugin/getPluginDisplay"><code>/plugin/:id/display</code></a>.</p>
<pre><code class="hljs css language-golang"><span class="hljs-comment">// Plugin is the plugin instance</span>
<span class="hljs-keyword">type</span> Plugin <span class="hljs-keyword">struct</span> {
    userCtx plugin.UserContext
}

<span class="hljs-comment">// GetDisplay implements plugin.Displayer</span>
<span class="hljs-comment">// Invoked when the user views the plugin settings. Plugins do not need to be enabled to handle GetDisplay calls.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Plugin)</span> <span class="hljs-title">GetDisplay</span><span class="hljs-params">(location *url.URL)</span> <span class="hljs-title">string</span></span> {
    <span class="hljs-keyword">if</span> (c.userCtx.Admin) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"You are an admin! You have super cow powers."</span>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"You are **NOT** an admin! You can do nothing:("</span>
    }
}

<span class="hljs-comment">// NewGotifyPluginInstance creates a plugin instance for a user context.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewGotifyPluginInstance</span><span class="hljs-params">(ctx plugin.UserContext)</span> <span class="hljs-title">plugin</span>.<span class="hljs-title">Plugin</span></span> {
    <span class="hljs-keyword">return</span> &amp;Plugin{ctx}
}
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="messenger"></a><a href="#messenger" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Messenger</h4>
<p><a href="https://godoc.org/github.com/gotify/plugin-api#Messenger"><code>Messenger</code></a> is used to send messages.
It is called with a callback that plugin instances can call at any time to send messages to the user.</p>
<pre><code class="hljs css language-golang"><span class="hljs-comment">// Plugin is the plugin instance</span>
<span class="hljs-keyword">type</span> Plugin <span class="hljs-keyword">struct</span> {
    msgHandler plugin.MessageHandler
}

<span class="hljs-comment">// SetMessageHandler implements plugin.Messenger</span>
<span class="hljs-comment">// Invoked during initialization</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Plugin)</span> <span class="hljs-title">SetMessageHandler</span><span class="hljs-params">(h plugin.MessageHandler)</span></span> {
    c.msgHandler = h
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Plugin)</span> <span class="hljs-title">Enable</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> {
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        time.Sleep(<span class="hljs-number">5</span> * time.Second)
        c.msgHandler.SendMessage(plugin.Message{
            Message: <span class="hljs-string">"The plugin has been enabled for 5 seconds."</span>,
        })
    }()
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="storager"></a><a href="#storager" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Storager</h4>
<p><a href="https://godoc.org/github.com/gotify/plugin-api#Storager"><code>Storager</code></a> is used to store permanent information on the gotify database on the user level.
Data serialization is handled by the plugin itself.</p>
<pre><code class="hljs css language-golang"><span class="hljs-comment">// Plugin is the plugin instance</span>
<span class="hljs-keyword">type</span> Plugin <span class="hljs-keyword">struct</span> {
    storageHandler plugin.StorageHandler
}

<span class="hljs-comment">// SetStorageHandler implements plugin.Storager</span>
<span class="hljs-comment">// Invoked during initialization</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Plugin)</span> <span class="hljs-title">SetStorageHandler</span><span class="hljs-params">(h plugin.StorageHandler)</span></span> {
    c.storageHandler = h
}

<span class="hljs-keyword">type</span> Storage <span class="hljs-keyword">struct</span> {
    EnabledTimes <span class="hljs-keyword">uint</span> <span class="hljs-string">`json:"enabled_times"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Plugin)</span> <span class="hljs-title">Enable</span><span class="hljs-params">()</span> <span class="hljs-title">error</span></span> {
    storage := <span class="hljs-built_in">new</span>(Storage)
    storageBytes, err := c.storageHandler.Load()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> err
    }
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(storageBytes) == <span class="hljs-number">0</span> {
        storage.EnabledTimes = <span class="hljs-number">1</span>
        storageBytes, _ = json.Marshal(storage)
        c.storageHandler.Save(storageBytes)
    } <span class="hljs-keyword">else</span> {
        json.Unmarshal(storageBytes, storage)
    }
    log.Printf(<span class="hljs-string">"This plugin has been enabled %d times."</span>, storage.EnabledTimes)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="webhooker"></a><a href="#webhooker" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Webhooker</h4>
<p><a href="https://godoc.org/github.com/gotify/plugin-api#Webhooker"><code>Webhooker</code></a> is used to register custom gin handlers.
The base path is the base path of the <code>RouterGroup</code>, which is kept consistent between restarts.
Plugins can assemble an absolute webhook URL by combining <code>basePath</code> and <code>location</code> parameter in <code>Displayer</code> call.
Useful to register webhook handlers. In theory you can even register a complete UI here.</p>
<pre><code class="hljs css language-golang"><span class="hljs-comment">// Plugin is the plugin instance</span>
<span class="hljs-keyword">type</span> Plugin <span class="hljs-keyword">struct</span> {
    basePath <span class="hljs-keyword">string</span>
}

<span class="hljs-comment">// RegisterWebhook implements plugin.Webhooker</span>
<span class="hljs-comment">// Invoked during initialization.</span>
<span class="hljs-comment">// Webhooks are unreachable when plugins are disabled.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Plugin)</span> <span class="hljs-title">RegisterWebhook</span><span class="hljs-params">(basePath <span class="hljs-keyword">string</span>, mux *gin.RouterGroup)</span></span> {
    c.basePath = basePath
    mux.POST(<span class="hljs-string">"/hook"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> {
        <span class="hljs-comment">// Processes webhook and take actions(sending messages, etc.)</span>
    })
}

<span class="hljs-comment">// GetDisplay implements plugin.Displayer</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Plugin)</span> <span class="hljs-title">GetDisplay</span><span class="hljs-params">(location *url.URL)</span> <span class="hljs-title">string</span></span> {
    baseLocation := &amp;url.URL{
        Path: c.basePath,
    }
    <span class="hljs-keyword">if</span> location != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">// If the server location can be determined, make the URL absolute</span>
        loc.Scheme = location.Scheme
        loc.Host = location.Host
    }
    loc = loc.ResolveReference(&amp;url.URL{
        Path: <span class="hljs-string">"hook"</span>,
    })
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"Set your webhook URL to %s and you are all set"</span>, loc)
}
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="configurer"></a><a href="#configurer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configurer</h4>
<p><a href="https://godoc.org/github.com/gotify/plugin-api#Configurer"><code>Configurer</code></a> is used to provide configuration interfaces to the user.
Marshaling and Unmarshaling is handled by the gotify main program.</p>
<p>The REST API for this is exposed at <a href="/api-docs#/plugin/getPluginConfig"><code>/plugin/:id/config</code></a>.</p>
<pre><code class="hljs css language-golang"><span class="hljs-comment">// Plugin is the plugin instance</span>
<span class="hljs-keyword">type</span> Plugin <span class="hljs-keyword">struct</span> {
    config *Config
}

<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {
    GitHubUserName <span class="hljs-keyword">string</span>
}

<span class="hljs-comment">// DefaultConfig implements plugin.Configurer</span>
<span class="hljs-comment">// The default configuration will be provided to the user for future editing. Also used for Unmarshaling.</span>
<span class="hljs-comment">// Invoked whenever an unmarshaling is required.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Plugin)</span> <span class="hljs-title">DefaultConfig</span><span class="hljs-params">()</span> <span class="hljs-title">interface</span></span>{} {
    <span class="hljs-keyword">return</span> &amp;Config{
        GitHubUserName: <span class="hljs-string">"jmattheis"</span>,
    }
}

<span class="hljs-comment">// ValidateAndSetConfig will be called every time the plugin is initialized or the configuration has been changed by the user.</span>
<span class="hljs-comment">// Plugins should validate the configuration and optionally return an error.</span>
<span class="hljs-comment">// Parameter is guaranteed to be the same type as the return type of DefaultConfig(), so it is safe to do a hard type assertion here.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// "Validation" in this context means to check for conflicting or impossible values, such as a non-URL on a field which should only contain a URL.</span>
<span class="hljs-comment">// In order to make sure that the plugin instance is always running in a valid state, this method should always accept the result of DefaultConfig()</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Invoked on initialization to provide initial configuration. Return nil to accept or return error to indicate that the config is obsolete.</span>
<span class="hljs-comment">// When the configuration is marked obsolete due to an unmarshaling error or rejection on the plugin side, the plugin is disabled automatically and the user is notified to resolve the config confliction.</span>
<span class="hljs-comment">// Invoked every time the config update API is called. Check the configuration and return nil to accept or return error to indicate that the config is invalid.</span>
<span class="hljs-comment">// Return a short and consise error here and, if you have detailed suggestions on how to solve the problem, utilize Displayer to provide more information to the user,</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Plugin)</span> <span class="hljs-title">ValidateAndSetConfig</span><span class="hljs-params">(c <span class="hljs-keyword">interface</span>{})</span> <span class="hljs-title">error</span></span> {
    config = c.(*Config)
    <span class="hljs-keyword">if</span> !userNameIsValid(config.GitHubUserName) {
        <span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">"the user name is not valid"</span>)
    }
    c.config = config
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="effective-plugin-practices"></a><a href="#effective-plugin-practices" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Effective Plugin Practices</h2>
<p>Although we have covered how to implement plugin functionalities in the last chapter, it is very important to take these practices to make sure your plugin can be loaded successfully and works effectively.</p>
<ul>
<li>Use <a href="https://github.com/golang/go/wiki/Modules">go modules</a> to manage dependencies, and use <a href="https://github.com/gotify/plugin-api/#githubcomgotifycmdgomod-cap">gomod-cap</a> to prevent incompatible dependencies.</li>
<li>Handle all errors. A panic in a goroutine spawned in the plugin can crash the whole gotify program.</li>
<li>Provide detailed plugin info and utilize <a href="/docs/plugin-api#displayer"><code>Displayer</code></a> to show instructions to users. A detailed plugin info would be shown in the WebUI which makes it easier to be identified and used.</li>
</ul>
<p>You can clone the official plugin <a href="https://github.com/gotify/plugin-template">template</a> and <a href="https://github.com/gotify/contrib">have a look at community contributions</a> to see plugins in action and/or to bootstrap your project.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/plugin"><span class="arrow-prev">← </span><span>Intro to Gotify Plugins</span></a><a class="docs-next button" href="/docs/plugin-deploy"><span>Building and Deploying Plugins</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#description">Description</a></li><li><a href="#apis">APIs</a><ul class="toc-headings"><li><a href="#intro">Intro</a></li><li><a href="#api-interfaces">API Interfaces</a></li></ul></li><li><a href="#effective-plugin-practices">Effective Plugin Practices</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2024 Gotify</section></footer></div></body></html>